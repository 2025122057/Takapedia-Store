<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products</title>

    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/style.css">
</head>
<body class="container my-4">

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-custom shadow-sm mb-4">
    <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center" href="dashboard.html">
            <img src="assets/images/logo.png" alt="Logo" width="40" height="40" class="me-2">
            <span class="text-white fw-bold">Takapedia Store</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarMenu">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link text-white" href="dashboard.html">Dashboard</a></li>
                <li class="nav-item"><a class="nav-link text-white active" href="products.html">Products</a></li>
                <li class="nav-item"><a class="nav-link text-white" href="orders.html">Orders</a></li>
                <li class="nav-item"><a class="nav-link text-white" href="customers.html">Customers</a></li>
                <li class="nav-item"><a class="nav-link text-white" href="index.html">Logout</a></li>
            </ul>
        </div>
    </div>
</nav>

<h2 class="mb-4 white-title">Products</h2>

<!-- Product Cards -->
<div class="row g-3 mb-4" id="productList"></div>

<!-- Add/Edit Product Form -->
<div class="product-form-card mb-5 p-3 shadow rounded">
    <h4 id="formTitle" class="mb-4 white-title">Add New Product</h4>
    <form id="productForm">
        <input type="hidden" id="productId">
        <div class="floating-label mb-3">
            <input type="text" id="name" placeholder=" " required>
            <label>Product Name</label>
        </div>
        <div class="floating-label mb-3">
            <input type="number" id="price" placeholder=" " required>
            <label>Price (RM)</label>
        </div>
        <div class="floating-label mb-3">
            <input type="number" id="stock" placeholder=" " required>
            <label>Stock Quantity</label>
        </div>
        <div class="floating-label mb-3">
            <input type="text" id="image" placeholder=" " required>
            <label>Product Image (filename)</label>
        </div>
        <div class="d-flex gap-2 flex-wrap">
            <button type="submit" class="btn btn-primary" id="submitBtn">Add Product</button>
            <button type="button" class="btn btn-secondary" id="cancelBtn" style="display:none;">Cancel</button>
        </div>
    </form>
</div>

<footer class="text-center mt-4">&copy; 2025 Takapedia Store | All Right Reserved</footer>

<script>
// ----- Initialize Products -----
let products = JSON.parse(localStorage.getItem('products')) || [
    {id:1,name:"T-Shirt",price:25,stock:20,image:"tshirt.jpeg"},
    {id:2,name:"Jeans",price:50,stock:15,image:"jeans.jpeg"},
    {id:3,name:"Bag",price:75,stock:8,image:"bag.jpeg"},
    {id:4,name:"Hat",price:15,stock:30,image:"hat.jpeg"},
    {id:5,name:"Sunglasses",price:30,stock:5,image:"sunglasses.jpeg"},
    {id:6,name:"Sneakers",price:60,stock:12,image:"sneakers.jpeg"},
    {id:7,name:"Watch",price:120,stock:25,image:"watch.jpeg"}
];

// ----- Render Products -----
function renderProducts() {
    const container = document.getElementById('productList');
    container.innerHTML = '';
    products.forEach(p => {
        const badge = p.stock < 13 ? 'badge-low' : 'badge-safe';
        container.innerHTML += `
        <div class="col-lg-3 col-md-4 col-sm-6">
            <div class="card h-100 shadow position-relative">
                <img src="assets/images/${p.image}" class="card-img-top" style="height:150px; object-fit:cover;">
                <span class="position-absolute top-0 start-0 m-2 badge ${badge}">Stock: ${p.stock}</span>
                <div class="card-body">
                    <h5 class="card-title">${p.name}</h5>
                    <p class="card-text">Price: RM${p.price}</p>
                </div>
                <div class="card-footer d-flex justify-content-between">
                    <button class="btn btn-primary btn-sm w-50 me-1" onclick="editProduct(${p.id})">Edit</button>
                    <button class="btn btn-danger btn-sm w-50 ms-1" onclick="deleteProduct(${p.id})">Delete</button>
                </div>
            </div>
        </div>`;
    });
}
renderProducts();

// ----- Save to localStorage -----
function saveProducts() {
    localStorage.setItem('products', JSON.stringify(products));
    // Trigger storage event for real-time dashboard update
    window.dispatchEvent(new Event('storage'));
}

// ----- Add / Update Product -----
const form = document.getElementById('productForm');
form.addEventListener('submit', function(e){
    e.preventDefault();
    const idField = document.getElementById('productId');
    const id = idField.value;
    const name = document.getElementById('name').value;
    const price = parseFloat(document.getElementById('price').value);
    const stock = parseInt(document.getElementById('stock').value);
    const image = document.getElementById('image').value;

    if(id) { // Update
        const index = products.findIndex(p=>p.id==id);
        products[index] = {id:parseInt(id),name,price,stock,image};
    } else { // Add
        const newId = products.length ? Math.max(...products.map(p=>p.id))+1 : 1;
        products.push({id:newId,name,price,stock,image});
    }

    saveProducts();
    renderProducts();
    form.reset();
    idField.value = '';
    document.getElementById('formTitle').innerText = 'Add New Product';
    document.getElementById('submitBtn').innerText = 'Add Product';
    document.getElementById('cancelBtn').style.display = 'none';
});

// ----- Delete Product -----
function deleteProduct(id){
    if(confirm('Are you sure you want to delete this product?')){
        products = products.filter(p => p.id !== id);
        saveProducts();
        renderProducts();
    }
}

// ----- Edit Product -----
function editProduct(id){
    const product = products.find(p => p.id === id);
    document.getElementById('productId').value = product.id;
    document.getElementById('name').value = product.name;
    document.getElementById('price').value = product.price;
    document.getElementById('stock').value = product.stock;
    document.getElementById('image').value = product.image;

    document.getElementById('formTitle').innerText = 'Edit Product';
    document.getElementById('submitBtn').innerText = 'Update Product';
    document.getElementById('cancelBtn').style.display = 'inline-block';
}

// ----- Cancel Edit -----
document.getElementById('cancelBtn').addEventListener('click', function(){
    form.reset();
    document.getElementById('productId').value = '';
    document.getElementById('formTitle').innerText = 'Add New Product';
    document.getElementById('submitBtn').innerText = 'Add Product';
    this.style.display = 'none';
});
</script>

<!-- Include Bootstrap JS bundle for mobile navbar toggle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
